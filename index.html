<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Sensio CMS Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body {font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0;}
header {background: linear-gradient(90deg,#007bff,#ffd700,#ff0000,#daa520,#c0c0c0); padding:20px; color:white; text-align:center;}
.container {max-width:1000px; margin:auto; padding:20px;}
input, textarea, select {width:100%; margin:5px 0; padding:10px; border-radius:5px; border:1px solid #ccc;}
button {padding:10px 20px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer;}
button:hover {background:#0056b3;}
.post {background:white; padding:15px; margin:15px 0; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
.post img, .post video {max-width:100%; margin-top:10px; border-radius:5px;}
.actions {margin-top:10px;}
.actions button {margin-right:5px; background:#28a745;}
.actions button.delete {background:#dc3545;}
.actions button.edit {background:#ffc107; color:black;}
.actions button.share {background:#17a2b8;}
.progress-bar {height:20px; background:#007bff; text-align:center; color:white; border-radius:5px; margin-top:5px;}
.search-container {margin:20px 0;}
.search-container input {width:50%; display:inline-block;}
</style>
</head>
<body>

<header>
<h1>Sensio - Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</h1>
</header>

<div class="container">

<h2>âœï¸ ÙƒØªØ§Ø¨Ø© Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h2>
<input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„">
<textarea id="content" rows="6" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‡Ù†Ø§"></textarea>

<select id="category">
<option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
<option value="Ø£Ø®Ø¨Ø§Ø±">Ø£Ø®Ø¨Ø§Ø±</option>
<option value="ØµÙˆØªÙŠØ§Øª">ØµÙˆØªÙŠØ§Øª</option>
<option value="ÙÙŠØ¯ÙŠÙˆ">ÙÙŠØ¯ÙŠÙˆ</option>
</select>

<input type="file" id="image" accept="image/*">
<input type="file" id="videoFile" accept="video/*">

<div id="imageProgress" class="progress-bar" style="display:none;">0%</div>
<div id="videoProgress" class="progress-bar" style="display:none;">0%</div>

<button onclick="publish()">Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„</button>

<hr>

<div class="search-container">
<input type="text" id="search" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª..." oninput="filterPosts()">
</div>

<h2>ğŸ“š Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h2>
<div id="posts"></div>

</div>

<script>
// --- Firebase Configuration ---
const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// --- Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ ---
let currentEditId = null;

async function publish(editId=null){
  const title = document.getElementById("title").value.trim();
  const content = document.getElementById("content").value.trim();
  const category = document.getElementById("category").value;
  const imageFile = document.getElementById("image").files[0];
  const videoFile = document.getElementById("videoFile").files[0];

  if(!title || !content) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø§Ù„");

  let imageUrl = "", videoUrl = "";

  if(imageFile){
    const storageRef = storage.ref('images/'+Date.now()+'-'+imageFile.name);
    const uploadTask = storageRef.put(imageFile);
    document.getElementById("imageProgress").style.display = "block";
    uploadTask.on('state_changed', snapshot=>{
      const progress = Math.floor(snapshot.bytesTransferred/snapshot.totalBytes*100);
      document.getElementById("imageProgress").textContent = progress + "%";
    });
    await uploadTask;
    imageUrl = await storageRef.getDownloadURL();
    document.getElementById("imageProgress").style.display = "none";
  }

  if(videoFile){
    const storageRef = storage.ref('videos/'+Date.now()+'-'+videoFile.name);
    const uploadTask = storageRef.put(videoFile);
    document.getElementById("videoProgress").style.display = "block";
    uploadTask.on('state_changed', snapshot=>{
      const progress = Math.floor(snapshot.bytesTransferred/snapshot.totalBytes*100);
      document.getElementById("videoProgress").textContent = progress + "%";
    });
    await uploadTask;
    videoUrl = await storageRef.getDownloadURL();
    document.getElementById("videoProgress").style.display = "none";
  }

  if(editId){
    await db.collection("posts").doc(editId).update({title, content, category, image:imageUrl, video:videoUrl, date:new Date().toLocaleString()});
  } else {
    await db.collection("posts").add({title, content, category, image:imageUrl, video:videoUrl, date:new Date().toLocaleString()});
  }

  document.getElementById("title").value="";
  document.getElementById("content").value="";
  document.getElementById("image").value="";
  document.getElementById("videoFile").value="";
  currentEditId = null;

  loadPosts();
}

// --- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª ---
let allPosts = [];
async function loadPosts(){
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML="";
  const querySnapshot = await db.collection("posts").orderBy("date","desc").get();
  allPosts = [];
  querySnapshot.forEach(doc=>{
    const p = doc.data();
    p.id = doc.id;
    allPosts.push(p);
  });
  displayPosts(allPosts);
}

function displayPosts(posts){
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML="";
  posts.forEach(p=>{
    let html = `<div class="post" id="post-${p.id}">
      <h3>${p.title} <small>[${p.category}]</small></h3>
      <small>${p.date}</small>
      <p>${p.content}</p>`;
    if(p.image) html += `<img src="${p.image}">`;
    if(p.video) html += `<video controls src="${p.video}"></video>`;
    html += `<div class="actions">
      <button class="edit" onclick="editPost('${p.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
      <button class="delete" onclick="deletePost('${p.id}')">Ø­Ø°Ù</button>
      <button class="share" onclick="sharePost('${p.id}')">Ù…Ø´Ø§Ø±ÙƒØ©</button>
    </div></div>`;
    postsDiv.innerHTML += html;
  });
}

// --- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ ---
function editPost(id){
  const post = allPosts.find(p=>p.id===id);
  if(!post) return;
  document.getElementById("title").value = post.title;
  document.getElementById("content").value = post.content;
  document.getElementById("category").value = post.category;
  currentEditId = id;
}

// --- Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„ ---
async function deletePost(id){
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ù„ØŸ")){
    await db.collection("posts").doc(id).delete();
    loadPosts();
  }
}

// --- Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù‚Ø§Ù„ ---
function sharePost(id){
  const url = window.location.href.split('#')[0]+"#post-"+id;
  navigator.clipboard.writeText(url);
  alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: "+url);
}

// --- ØªØµÙÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª ---
function filterPosts(){
  const keyword = document.getElementById("search").value.toLowerCase();
  const filtered = allPosts.filter(p=>p.title.toLowerCase().includes(keyword) || p.content.toLowerCase().includes(keyword));
  displayPosts(filtered);
}

// --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadPosts();
</script>

</body>
</html>
