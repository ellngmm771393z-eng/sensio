<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ù…Ø§Ø³Ø© | Almasa - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0;}
header {background: linear-gradient(90deg,#007bff,#ffd700,#ff0000,#daa520,#c0c0c0); padding:20px; color:white; text-align:center;}
.container {max-width:1200px; margin:auto; padding:20px;}
input, textarea, select {width:100%; margin:5px 0; padding:10px; border-radius:5px; border:1px solid #ccc;}
button {padding:10px 20px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer;}
button:hover {background:#0056b3;}
.post {background:white; padding:15px; margin:15px 0; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
.post img, .post video {max-width:100%; margin-top:10px; border-radius:5px;}
.actions {margin-top:10px;}
.actions button {margin-right:5px; background:#28a745;}
.actions button.delete {background:#dc3545;}
.actions button.edit {background:#ffc107; color:black;}
.actions button.share {background:#17a2b8;}
.progress-bar {height:20px; background:#007bff; text-align:center; color:white; border-radius:5px; margin-top:5px;}
.search-container {margin:20px 0;}
.search-container input {width:50%; display:inline-block;}
.radio-container {margin:20px 0; padding:10px; background:#fff3cd; border-radius:5px;}
.stats {margin-top:5px; font-size:0.9em; color:#555;}
.sections {display:flex; justify-content:center; flex-wrap:wrap; margin:20px 0;}
.sections button {margin:5px; background:#17a2b8; color:white;}
.sections button:hover {background:#117a8b;}
</style>
</head>
<body>

<header>
<h1>Ø§Ù„Ù…Ø§Ø³Ø© | Almasa - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</h1>
</header>

<!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£ÙÙ‚ÙŠØ© Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© -->
<div class="sections">
  <button onclick="window.location.href='index.html'">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <button onclick="filterBySection('Ø¥Ø³Ù„Ø§Ù…ÙŠØ§Øª')">Ø¥Ø³Ù„Ø§Ù…ÙŠØ§Øª</button>
  <button onclick="filterBySection('Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©')">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</button>
  <button onclick="filterBySection('Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©')">Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</button>
  <button onclick="filterBySection('Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ')">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ</button>
  <button onclick="filterBySection('Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©')">Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©</button>
</div>

<div class="container">

<h2>âœï¸ Ø¥Ù†Ø´Ø§Ø¡ / ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‚Ø§Ù„</h2>
<input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„">
<textarea id="content" rows="6" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‡Ù†Ø§"></textarea>

<select id="category">
  <option value="Ø¥Ø³Ù„Ø§Ù…ÙŠØ§Øª">Ø¥Ø³Ù„Ø§Ù…ÙŠØ§Øª</option>
  <option value="Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
  <option value="Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©">Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</option>
  <option value="Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ</option>
  <option value="Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©">Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©</option>
</select>

<input type="file" id="image" accept="image/*">
<input type="file" id="videoFile" accept="video/*">

<div id="imageProgress" class="progress-bar" style="display:none;">0%</div>
<div id="videoProgress" class="progress-bar" style="display:none;">0%</div>

<button onclick="publish()">Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„</button>

<hr>

<div class="radio-container">
<h3>ğŸ“» Ø§Ø®ØªØ± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ</h3>
<select id="radioSelect" onchange="changeRadio()">
<option value="stream">Ø±Ø§Ø¯ÙŠÙˆ stream Ù„Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</option>
<option value="morocco">Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù…ØºØ±Ø¨ Ù„Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</option>
</select>
<audio id="radioPlayer" controls>
  <source id="radioSource" src="https://stream-url-example.com/stream.mp3" type="audio/mpeg">
  Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª.
</audio>
</div>

<div class="search-container">
<input type="text" id="search" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª..." oninput="filterPosts()">
<select id="filterCategory" onchange="filterPosts()">
<option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
<option value="Ø¥Ø³Ù„Ø§Ù…ÙŠØ§Øª">Ø¥Ø³Ù„Ø§Ù…ÙŠØ§Øª</option>
<option value="Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
<option value="Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©">Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</option>
<option value="Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ</option>
<option value="Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©">Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©</option>
</select>
</div>

<h2>ğŸ“š Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h2>
<div id="posts"></div>

<h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</h2>
<canvas id="viewsChart" width="400" height="150"></canvas>

</div>

<script>
// --- Firebase Configuration ---
const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// --- Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ ---
let currentEditId = null;
async function publish(editId=null){
  const title = document.getElementById("title").value.trim();
  const content = document.getElementById("content").value.trim();
  const category = document.getElementById("category").value;
  const imageFile = document.getElementById("image").files[0];
  const videoFile = document.getElementById("videoFile").files[0];
  if(!title || !content) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø§Ù„");

  let imageUrl = "", videoUrl = "";

  if(imageFile){
    const storageRef = storage.ref('images/'+Date.now()+'-'+imageFile.name);
    const uploadTask = storageRef.put(imageFile);
    document.getElementById("imageProgress").style.display = "block";
    uploadTask.on('state_changed', snapshot=>{
      const progress = Math.floor(snapshot.bytesTransferred/snapshot.totalBytes*100);
      document.getElementById("imageProgress").textContent = progress + "%";
    });
    await uploadTask;
    imageUrl = await storageRef.getDownloadURL();
    document.getElementById("imageProgress").style.display = "none";
  }

  if(videoFile){
    const storageRef = storage.ref('videos/'+Date.now()+'-'+videoFile.name);
    const uploadTask = storageRef.put(videoFile);
    document.getElementById("videoProgress").style.display = "block";
    uploadTask.on('state_changed', snapshot=>{
      const progress = Math.floor(snapshot.bytesTransferred/snapshot.totalBytes*100);
      document.getElementById("videoProgress").textContent = progress + "%";
    });
    await uploadTask;
    videoUrl = await storageRef.getDownloadURL();
    document.getElementById("videoProgress").style.display = "none";
  }

  if(editId){
    await db.collection("posts").doc(editId).update({title, content, category, image:imageUrl, video:videoUrl, date:new Date().toLocaleString()});
  } else {
    await db.collection("posts").add({title, content, category, image:imageUrl, video:videoUrl, date:new Date().toLocaleString(), views:0});
  }

  document.getElementById("title").value="";
  document.getElementById("content").value="";
  document.getElementById("image").value="";
  document.getElementById("videoFile").value="";
  currentEditId = null;

  loadPosts();
}

// --- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª ---
let allPosts = [];
async function loadPosts(){
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML="";
  const querySnapshot = await db.collection("posts").orderBy("date","desc").get();
  allPosts = [];
  let labels = [], data = [];
  querySnapshot.forEach(doc=>{
    const p = doc.data();
    p.id = doc.id;
    allPosts.push(p);
    labels.push(p.title);
    data.push(p.views || 0);
  });
  displayPosts(allPosts);
  updateChart(labels, data);
}

function displayPosts(posts){
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML="";
  posts.forEach(p=>{
    let html = `<div class="post" id="post-${p.id}">
      <h3 onclick="increaseView('${p.id}')" style="cursor:pointer;">${p.title} <small>[${p.category}]</small></h3>
      <small>${p.date}</small>
      <div class="stats">Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${p.views || 0}</div>
      <p>${p.content}</p>`;
    if(p.image) html += `<img src="${p.image}">`;
    if(p.video) html += `<video controls src="${p.video}"></video>`;
    html += `<div class="actions">
      <button class="edit" onclick="editPost('${p.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
      <button class="delete" onclick="deletePost('${p.id}')">Ø­Ø°Ù</button>
      <button class="share" onclick="sharePost('${p.id}')">Ù…Ø´Ø§Ø±ÙƒØ©</button>
    </div></div>`;
    postsDiv.innerHTML += html;
  });
}

async function increaseView(id){
  const docRef = db.collection("posts").doc(id);
  await db.runTransaction(async (t)=>{
    const doc = await t.get(docRef);
    const currentViews = doc.data().views || 0;
    t.update(docRef, {views: currentViews + 1});
  });
  loadPosts();
}

function editPost(id){
  const post = allPosts.find(p=>p.id===id);
  if(!post) return;
  document.getElementById("title").value = post.title;
  document.getElementById("content").value = post.content;
  document.getElementById("category").value = post.category;
  currentEditId = id;
}

async function deletePost(id){
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ù„ØŸ")){
    await db.collection("posts").doc(id).delete();
    loadPosts();
  }
}

function sharePost(id){
  const url = window.location.href.split('#')[0]+"#post-"+id;
  navigator.clipboard.writeText(url);
  alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: "+url);
}

function filterPosts(){
  const keyword = document.getElementById("search").value.toLowerCase();
  const filterCat = document.getElementById("filterCategory").value;
  const filtered = allPosts.filter(p=>{
    return (p.title.toLowerCase().includes(keyword) || p.content.toLowerCase().includes(keyword)) &&
           (filterCat==="" || p.category===filterCat);
  });
  displayPosts(filtered);
}

function filterBySection(section){
  if(section === "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©") window.location.href='index.html';
  else displayPosts(allPosts.filter(p=>p.category===section));
}

function changeRadio(){
  const sel = document.getElementById("radioSelect").value;
  const radio = document.getElementById("radioPlayer");
  if(sel==="stream") radio.src = "https://stream-url-example.com/stream.mp3";
  else if(sel==="morocco") radio.src = "https://morocco-stream-url.com/stream.mp3";
  radio.load();
  radio.play();
}

function updateChart(labels, data){
  const ctx = document.getElementById('viewsChart').getContext('2d');
  if(window.viewsChartInstance) window.viewsChartInstance.destroy();
  window.viewsChartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ù„ÙƒÙ„ Ù…Ù‚Ø§Ù„',
        data: data,
        backgroundColor: '#007bff'
      }]
    },
    options: {
      responsive:true,
      plugins:{
        legend:{display:false},
        title:{display:true, text:'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª'}
      }
    }
  });
}

loadPosts();
</script>

</body>
</html>
